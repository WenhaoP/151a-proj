---
output:
  pdf_document: default
  html_document: default
---

```{r}
library(ggplot2)
library(car)
library(dplyr)
EDA_df <- read.csv("data/EDA.csv")
EDA_df$CIG_0_BIN <- factor(EDA_df$CIG_0_BIN)
EDA_df$PRECARE <- factor(EDA_df$PRECARE)
EDA_df$SEX <- factor(EDA_df$SEX)
EDA_df$RESTATUS <- factor(EDA_df$RESTATUS)
EDA_df$PAY <- factor(EDA_df$PAY)
EDA_df$NO_RISKS <- factor(EDA_df$NO_RISKS)
EDA_df$MRAVE6 <- factor(EDA_df$MRAVE6)
EDA_df$FRACE6  <- factor(EDA_df$FRACE6)
EDA_df$MEDUC <- factor(EDA_df$MEDUC)
EDA_df$FEDUC <- factor(EDA_df$FEDUC)
```

# Response variable:

```{r}
# response variable
ggplot(EDA_df, aes(x = DBWT)) +
  geom_histogram()

# Measure of symmetry
DBWT_sym = (quantile(EDA_df$DBWT, 0.75) - median(EDA_df$DBWT)) /
  (median(EDA_df$DBWT) - quantile(EDA_df$DBWT, 0.25))
```

# MAGER

```{r}
ggplot(EDA_df, aes(x = MAGER, y = DBWT)) +
  geom_point(position = "jitter") +
  geom_smooth()
```

```{r}
ggplot(EDA_df, aes(x = MAGER, y = DBWT)) +
  geom_point(position = "jitter", aes(colour = CIG_0_BIN), alpha = 0.5) +
  geom_smooth(method = 'lm', aes(colour = CIG_0_BIN))
```
Slightly negative slope for smoking mothers between `MAGER` and `DBWT`.

# PRECARE

```{r}
ggplot(EDA_df, aes(x = PRECARE, y = DBWT)) +
  geom_boxplot()
```
Observing that the most important difference lies between `PRECARE` of 0 and the other status of `PRECARE`, we binarize `PRECARE` for downstream analysis.

```{r}
# Binarizing PRECARE
EDA_df$PRECARE_BIN <- factor(ifelse(EDA_df$PRECARE == 0, FALSE, TRUE))
ggplot(EDA_df, aes(x = PRECARE_BIN, y = DBWT)) +
  geom_boxplot()
```


```{r}
EDA_df %>% count(PRECARE) 
```

No `PRECARE` has significant `DBWT`.

```{r}
ggplot(EDA_df, aes(x = PRECARE_BIN, y = DBWT)) +
  geom_boxplot(aes(fill = SEX))
```

`SEX` matters more for higher `PRECARE` (start prenatal care later). 

# CIG_0_BIN

```{r}
ggplot(EDA_df, aes(x = CIG_0_BIN, y = DBWT)) +
  geom_boxplot()
```

No smoking leads to higher `DBWT`.

```{r}
ggplot(EDA_df, aes(x = CIG_0_BIN, y = DBWT)) +
  geom_boxplot(aes(fill = PRECARE_BIN))
```

`PRECARE` difference is more obvious in smoking mothers. But it might due to the relative smaller number of smoking mothers.

```{r}
EDA_df %>% count(CIG_0_BIN)
```

# BMI:

```{r}
ggplot(EDA_df, aes(x = BMI, y = DBWT)) +
  geom_point() +
  geom_smooth()
```

```{r}
ggplot(EDA_df, aes(x = BMI, y = DBWT)) +
  geom_point(aes(colour = PAY), alpha = 0.5) +
  geom_smooth(method = 'lm', aes(colour = PAY))
```
```{r}
ggplot(EDA_df, aes(x = BMI, y = DBWT)) +
  geom_point(aes(colour = PRECARE_BIN), alpha = 0.5) +
  geom_smooth(aes(colour = PRECARE_BIN))
```

```{r}
EDA_df %>% count(PAY)
```

# WTGAIN.percentage:

```{r}
ggplot(EDA_df, aes(x = WT.percent.gain, y = DBWT)) +
  geom_point() +
  geom_smooth()
```

```{r}
ggplot(EDA_df, aes(x = WT.percent.gain, y = DBWT)) +
  geom_point(aes(colour = PAY), alpha = 0.5) +
  geom_smooth(method = 'lm', aes(colour = PAY))
```

```{r}
ggplot(EDA_df, aes(x = WT.percent.gain, y = DBWT)) +
  geom_point(aes(colour = MEDUC), alpha = 0.5) +
  geom_smooth(method = "lm",aes(colour = MEDUC))
```

# SEX

```{r}
ggplot(EDA_df, aes(x = SEX, y = DBWT)) +
  geom_boxplot()
```

```{r}
ggplot(EDA_df, aes(x = SEX, y = DBWT)) +
  geom_boxplot(aes(fill = PRECARE_BIN))
```

`PRECARE` matters more in male babies.

# PREVIS

```{r}
ggplot(EDA_df, aes(x = PREVIS, y = DBWT)) +
  geom_point(position = "jitter") +
  geom_smooth()
```

```{r}
ggplot(EDA_df, aes(x = PREVIS, y = DBWT)) +
  geom_point(position = "jitter", aes(colour = PRECARE_BIN), alpha = 0.5) +
  geom_smooth(method = "lm", aes(colour = PRECARE_BIN))
```

```{r}
ggplot(EDA_df, aes(x = PREVIS, y = DBWT)) +
  geom_point(position = "jitter", aes(colour = PAY), alpha = 0.5) +
  geom_smooth(method = "lm", aes(colour = PAY))
```

```{r}
ggplot(EDA_df, aes(x = PREVIS, y = DBWT)) +
  geom_point(position = "jitter", aes(colour = FEDUC), alpha = 0.5) +
  geom_smooth(method = "lm", aes(colour = FEDUC))

ggplot(EDA_df, aes(x = PREVIS, y = DBWT)) +
  geom_point(position = "jitter", aes(colour = MEDUC), alpha = 0.5) +
  geom_smooth(method = "lm", aes(colour = MEDUC))

EDA_df %>% count(FEDUC)
EDA_df %>% count(MEDUC)
```


```{r}
cols_of_interest <- c("MAGER", "PRECARE_BIN", "CIG_0_BIN", "BMI", "WT.percent.gain", "SEX", "PREVIS", "pregnancy.length", "MRAVE6", "FRACE6", "MEDUC", "FEDUC")

dtypes <- sapply(EDA_df, class)

for (A in cols_of_interest) {
  for (B in cols_of_interest) {
    if (A == B) {
      next
    } 
    if (dtypes[A] == "factor" & dtypes[B] == "factor") {
      fig <- ggplot(EDA_df, aes_string(x = A, y = "DBWT")) + geom_boxplot(aes_string(fill = B))
    } else if (dtypes[B] == "factor") {
      fig <- ggplot(EDA_df, aes_string(x = A, y = "DBWT")) +
        geom_point(position = "jitter", aes_string(colour = B), alpha = 0.5) +
        geom_smooth(method = "lm", aes_string(colour = B))
      # coplot(formula(paste("DBWT ~", A, '|', B)), data = EDA_df)
    } else if (dtypes[A] == "factor") {
      # coplot(formula(paste("DBWT ~", B, '|', A)), data = EDA_df)
      fig <- ggplot(EDA_df, aes_string(x = B, y = "DBWT")) +
        geom_point(position = "jitter", aes_string(colour = A), alpha = 0.5) +
        geom_smooth(method = "lm", aes_string(colour = A))
    } else {
      # Both are numeric, don't look at interactions here
      next
    }
    print(fig)
  }
}
```

